function getBook(method,query){
    fetch(`/library/GetBook/${method}?query=${encodeURIComponent(query)}`)
    .then(response=>response.json())
    .then(data=>{console.log(data);showBooks(data)})
    .catch(err=>showBooks(null));
}

function showBooks(data){
    let bookshelf=document.getElementById("bookShelf");
    if(data==null||data==0){
        bookshelf.innerHTML=`<center><h2 id="nO">No books found<br>Did you type it right?</h2></center>`;
    }else{
       bookshelf.innerHTML="";
       data.forEach(book => {
           bookshelf.innerHTML+=`
            <div class="bookShow">
                <img src="imgs/default.jpg" alt="bookImage">
                <div class="description">
                    <a onclick='selectBook("id","${book.id}")' class="title">${book.title}</a>
                    <p>${book.author}<br>${book.pubYear}</p>
                </div>
            </div>
           `
       });
    }
}

function allBooks(){
    fetch(`/library/Count`).then(response=>response.text()).then(response=>
        document.getElementById("totalBooks").innerText=`There are ${response} books in the library`);
    fetch(`/library/ListBooks/all`).then(response=>response.json()).then(response=>showBooks(response));
    
}

function selectBook(aspect,info){
    fetch(`/library/GetBook/${aspect}?query=${encodeURIComponent(info)}`)
    .then(response=>response.json())
    .then(data=>data.forEach(book=>{
        console.log(
            book['title'],
            book['id'],
            book['available'],
            book['pubYear'],
            book['categor']
        )
        let a="Not Available";
        if(book.available==1){
            a="available";
        }

        let bookshelf=document.getElementById("bookSearch");
        bookshelf.innerHTML=`
        <div class="inspector">
            <div id="description">
                <h2>${book.id} - ${book.title}</h2>
                <h3>${book.author} - ${book.pubYear}</h3>
                <h3>${book.category}</h3>
                <p>${a}</p>
            </div>
            <button onclick="Select('close')">X</button>
            <img src="imgs/default.jpg" alt="">
        </div>
        `;
        Select("open");
    }))
}

function Select(a){
    let bookshelf=document.getElementById("bookShelf").querySelectorAll("div");
    let bookSearch=document.getElementById("bookSearch");
    if(a=="open"){
        bookshelf.forEach(book=>book.setAttribute("hidden",""));
        bookSearch.removeAttribute("hidden");
    }else if(a=="close"){
        bookSearch.setAttribute("hidden","");
        bookshelf.forEach(book=>book.removeAttribute("hidden"));
    }else{
        console.log("Error: Unknown method to 'select' at function 'Select(a)'")
        return;
    }
}


function update(){
    yearFilter=document.getElementById("filterType").value;
    serch=document.getElementById("searchBar");
    if(yearFilter=="pubYear"){
        serch.setAttribute("placeholder","Type the book's pub. year");
        serch.setAttribute("type","number");
    }else if(yearFilter=="id"){
        serch.setAttribute("type","number");
        serch.setAttribute("placeholder","Type the book's id");
    }else if(yearFilter=="author"){
        serch.setAttribute("placeholder","Type the book author's name");
    }else{
        serch.setAttribute("type","text");
        serch.setAttribute("placeholder","Type the book's name");
    }
}

function clearSearch(){
    document.getElementById("searchBar").value="";
    allBooks();
}

function search(){
    let type=document.getElementById("filterType").value;
    let info=document.getElementById("searchBar").value;
    switch(type){
        case "title":
            if(info==null||info==""){
                alert("Type the name of the book at the search bar");
                return;
            }
        break;
        case "author":
            if(info==null||info==""){
                alert("Type the name of the book's author at the search bar");
                return;
            }
        break;
        case "pubYear":
            year=Number(info);
            if(year==null||year==""){
                alert("Type the year at the search bar");
            }
        break;
        case "id":
            info=Number(info);
            if(info==null||info==""){
                alert("Type the book's id at the search bar");
            }
        break;
        default:
            alert("Stop messing around");
        return;
    }
    getBook(type,info);
}


body{
    background-color: #2d2d2d;
    font-family: monospace;
    user-select: none;
    margin: 0;
    display: flex;
    flex-direction: column;
}
h1{
    color: black;
    background-color: white;
    border-radius: 4px;
    width: 90%;
    margin-left: -1%;
}
#nO{
    position: absolute;
    margin-left: 41%;
}
#mainPage{
    padding:5px;
    border-radius: 10px;
    display: flex;
    flex: 1;
    margin-left: 4%;
}


/*?--side--?*/
#mainPage aside{
    padding:5px;
    border-radius: 10px;
    background-color: darkgray;
    min-height: 20%;
    width: 20%;
    margin-right:5px ;
    position: relative;
}

#searchButton{
    color: black;
    height: 27px;
    font-size: 18px;
    background-color: aquamarine;
    cursor: pointer;
    margin-left: 2px;
    border-radius: 4px;
}
#adv{
    padding: 2px;
    border-radius: 4px;
    background-color: #0000000f;
    margin-left: 4%;
    cursor: pointer;
    width: min-content;
}
#EM{
    position: absolute;
    margin-top: -5%;
    margin-left: 50%;
}
#extraSearch{
    margin-left: 0%;
    
}

#clearButton{
    color: black;
    background-color: lightblue;
    cursor: pointer;
    margin-left: 4%;
    border-radius: 4px;
}
#searchDiv #extraSearch{
    margin-left: 5%;
}
#searchBar{
    margin-left: 4%;
    border-radius: 4px;
    border: 2px solid black;
    font-size: 18px;
    width: 70%;
}
#menuDiv{
    margin-left: 2%;
    font-size: larger;
    color: black;
}


/*!--side--!*/


/*?--main--?*/
#mainPage main{
    padding:5px;
    border-radius: 10px;
    background-color: lightgray;
    width: 73%;
    height: 850px;
    overflow: scroll;
    overflow-x: hidden;
}
::-webkit-scrollbar{
    border-radius: 4px;
    background-color: grey;
}
::-webkit-scrollbar-thumb{
    background-color: white;
    border-radius: 4px;
}
.bookShow{
    background-color: darkgray;
    height: 350px;
    max-height: 350px;
    width: 200px;
    max-width: 200px;
    padding: 5px;
    border-radius:5px;
    position: relative;
}
.bookShow img{
    border-radius:5px;
    margin-bottom: 50px;
    max-height: 250px;
    max-width: 200px;
}
.bookShow .description{
    position: absolute;
    max-width: 200px;
    max-height:100px;
    margin-top: -20%;
}
.bookShow .title{
    color: black;
    margin-top: -1%;
    margin-left: 2%;
    word-break: break-all;
    font-size: 15px;
}
.bookShow a{
    cursor: pointer;
}
#bookShelf{
    position:relative;
    display: flex;
    flex-wrap:wrap;
    gap: 10px;
    
}
.inspector{
    height: auto;
    width: 80%;
    margin-left: 10%;
    border-radius: 5px;
    padding: 5px;
    background-color: darkgrey;
    position: relative;
}
.inspector button{
    position: absolute;
    cursor:pointer;
    border-radius: 3px;
    background-color: lightcoral;
    margin-left: 96%;
}
.inspector #description{
    position: absolute;
    margin-left: 52%;
}
.inspector h2{
    font-size: 30px;
}
.inspector h3{
    font-size: 18px;
}
.inspector img{
    max-width: 50%;
    background-color: aliceblue;
}
/*!--main--!*/
footer{
    background-color: white;
    border-radius: 10px;
    width: 91%;
    margin-left: 4%;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library</title>
    <link rel="stylesheet" href="style.css">
    <script src="cogs.js"></script>
</head>
<body onload="allBooks()"><!---->
<center><h1>Library!</h1></center>
    <div id="mainPage">
        <aside onclick="update()">
          <div><p id="totalBooks"></p>
        
          <div id="searchDiv">
            <input type="text" placeholder="Type the book's name" id="searchBar"><button id="searchButton" onclick="search()">Search</button>
            <br>
            <br>
            <button id="clearButton" onclick="clearSearch()">Clear</button>
            <div id="extraSearch">
              <br>  
                <select id="filterType">
                  <option selected value="title">Title</option>
                  <option value="author">Author</option>
                  <option value="pubYear">Publication year</option>
                  <option value="id">Book id</option>
                </select>
                <div id="EM">
                  <input style="cursor: pointer;" type="checkbox" id="ae"><label for="ae">Exact match</label><br>
                  <input style="cursor: pointer;" type="checkbox" id="av"><label for="av">Available</label>
                </div>
              </div>
              
          </div>
          <br>

          <div id="menuDiv">
            <ul>
              <h3>Categories</h3>
              <li><a href="">Horror</a></li>
              <li><a href="">Encyclopedies</a></li>
              <li><a href="">Science</a></li>
              <li><a href="">Romance</a></li>
              <li><a href="">etc, idk, im not an expert</a></li>
            </ul>
          </div>
          
        </aside>
        <main>
            <center><h1 id="mainTitle">Library content</h1></center><br>
            <div class="bookShelf" id="bookShelf">
              <!--
                <div class="bookShow">
                  <img src="" alt="">
                  <div id="description">
                    <a onclick="selectBook('title','${book.title}'')" id="title">Book title placeholder!</a>
                    <p>author placeholder<br>year too</p>
                  </div>
                </div>
              -->

              <!--
                <div class="inspector">
                  <div id="description">
                    <h2>id - title</h2>
                    <h3>author - pubyear</h3>
                    <h3>category</h3>
                    <p>Available or not</p>
                  </div>
                  <img src="imgs/default.jpg" alt="">
                </div>
              -->

            </div>
            <div hidden class="bookShelf" id="bookSearch">
            </div>
        </main>
      </div>
      <footer>
        <center><p>My library...</p></center>
      </footer>

</body>
</html>